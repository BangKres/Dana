<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Tabungan Mini (Firebase)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 14px;
      margin: 20px;
      background: #1e1e1e;
      color: #f0f0f0;
    }

    .header { display: flex; justify-content: space-between; margin-bottom: 12px; }
    .saldo { font-weight: bold; font-size: 18px; color: #8bc34a; }

    label { font-weight: bold; }
    select, input {
      padding: 6px; font-size: 14px; border-radius: 8px; border: 1px solid #555;
      background: #2b2b2b; color: #f0f0f0;
    }
    .table-container {
      max-height: 300px; overflow-y: auto; border: 1px solid #444;
      border-radius: 6px; background: #2a2a2a; margin-bottom: 20px;
    }

    table {
      border-collapse: collapse; width: 100%; font-size: 12px;
      text-align: center; background-color: #2a2a2a; color: #f0f0f0;
    }

    th, td { border: 1px solid #555; padding: 8px 4px; height: 12px; }
    thead th {
      background-color: #333; position: sticky; top: 0; z-index: 2; color: #f0f0f0;
    }

    .input-section {
      margin-top: 10px; display: flex; flex-wrap: wrap;
      justify-content: center; gap: 10px;
    }

    button {
      padding: 8px 14px; font-size: 14px; border: none; border-radius: 6px;
      background-color: #444; color: #fff; cursor: pointer; transition: 0.3s;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.3);
    }

    button:hover { background-color: #666; transform: scale(1.05); }

    .hapus-button {
      background-color: #e53935; color: white; border: none; border-radius: 4px;
      padding: 2px 6px; font-size: 12px; cursor: pointer; transition: 0.3s;
    }

    .hapus-button:hover {
      background-color: #c62828; transform: scale(1.1);
    }

    .total-button-group {
      display: flex; gap: 10px; justify-content: center;
      width: 100%; margin-top: 10px;
    }

    #hasilTotalPerNama {
      margin-top: 16px; font-weight: bold; text-align: center; color: #ccc;
    }

    .bottom-button-container {
      display: flex; justify-content: center; margin-top: 30px;
    }

    .bottom-button-container button {
      background-color: #d32f2f; font-weight: bold;
    }

    .bottom-button-container button:hover {
      background-color: #b71c1c;
    }

    .input-group {
      display: flex; align-items: center; gap: 8px;
    }

    .input-group label {
      min-width: 45px; text-align: right; font-weight: bold;
    }

    .input-group select { width: 160px; }
  </style>
</head>
<body>

  <div class="header">
    <div class="saldo" id="totalSaldo">Total Saldo: 0</div>
  </div>

  <div class="table-container">
    <table id="tabelData">
      <thead>
        <tr>
          <th>Hapus</th>
          <th>Nama</th>
          <th>Hari</th>
          <th>Tanggal</th>
          <th>Masuk</th>
          <th>Keluar</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="input-section">
    <div class="input-group">
      <label for="namaBawah">Nama:</label>
      <select id="namaBawah">
        <option value="Thelar">Thelar</option>
        <option value="Saskia">Saskia</option>
      </select>
    </div>
    <input type="text" id="jumlahUang" inputmode="numeric" placeholder="0">
    <button onclick="tambahMasuk()">Tambah Masuk</button>
    <button onclick="tambahKeluar()">Tambah Keluar</button>
  </div>

  <div class="total-button-group">
    <button onclick="hitungTotal('Saskia')">Total Saskia</button>
    <button onclick="hitungTotal('Thelar')">Total Thelar</button>
  </div>

  <div id="hasilTotalPerNama"></div>

  <div class="bottom-button-container">
    <button onclick="resetData()">Reset Semua Data</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCJJ0JJNpHqT9nggGE1aA2vxJzyYfS0Gx0",
      authDomain: "tabungan-a47a7.firebaseapp.com",
      projectId: "tabungan-a47a7",
      databaseURL: "https://tabungan-a47a7-default-rtdb.firebaseio.com",
      storageBucket: "tabungan-a47a7.appspot.com",
      messagingSenderId: "791266805531",
      appId: "1:791266805531:web:766d3d235a96dd1b8075be",
      measurementId: "G-SKMT01Z2SC"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const inputJumlah = document.getElementById("jumlahUang");

    inputJumlah.addEventListener("input", function () {
      let value = this.value.replace(/\./g, '').replace(/\D/g, '');
      this.value = value ? formatAngka(value) : "";
    });

    function formatAngka(angka) {
      return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function parseInputAngka(input) {
      return parseInt(input.replace(/\./g, '')) || 0;
    }

    function tambahMasuk() {
      tambahData(true);
    }

    function tambahKeluar() {
      tambahData(false);
    }

    function tambahData(isMasuk) {
      const nama = document.getElementById("namaBawah").value;
      const jumlahInput = document.getElementById("jumlahUang").value;
      const jumlah = parseInputAngka(jumlahInput);

      if (jumlah <= 0) {
        alert("Masukkan jumlah uang yang valid!");
        return;
      }

      const tabel = document.getElementById("tabelData").getElementsByTagName("tbody")[0];
      let barisKosong = tabel.insertRow();
      for (let i = 0; i < 6; i++) barisKosong.insertCell();
      tambahButtonHapus(barisKosong);

      const today = new Date();
      const hari = today.toLocaleDateString('id-ID', { weekday: 'long' });
      const tanggal = today.toLocaleDateString('id-ID');

      barisKosong.cells[1].innerText = nama;
      barisKosong.cells[2].innerText = hari;
      barisKosong.cells[3].innerText = tanggal;
      barisKosong.cells[4].innerText = isMasuk ? formatAngka(jumlah) : "-";
      barisKosong.cells[5].innerText = !isMasuk ? formatAngka(jumlah) : "-";

      updateTotalSaldo();
      saveData();
      document.getElementById("jumlahUang").value = "";
    }

    function tambahButtonHapus(row) {
      const btn = document.createElement("button");
      btn.className = "hapus-button";
      btn.innerText = "X";
      btn.onclick = function () {
        if (confirm("Yakin hapus data ini?")) {
          row.remove();
          updateTotalSaldo();
          saveData();
        }
      };
      row.cells[0].appendChild(btn);
    }

    function updateTotalSaldo() {
      const tabel = document.getElementById("tabelData").getElementsByTagName("tbody")[0];
      let total = 0;
      Array.from(tabel.rows).forEach(row => {
        const masuk = parseInt(row.cells[4].innerText.replace(/\./g, '')) || 0;
        const keluar = parseInt(row.cells[5].innerText.replace(/\./g, '')) || 0;
        total += masuk - keluar;
      });
      document.getElementById("totalSaldo").innerText = "Total Saldo: " + formatAngka(total);
    }

    function hitungTotal(namaCari) {
      const tabel = document.getElementById("tabelData").getElementsByTagName("tbody")[0];
      let total = 0;
      Array.from(tabel.rows).forEach(row => {
        const nama = row.cells[1].innerText.trim();
        const masuk = parseInt(row.cells[4].innerText.replace(/\./g, '')) || 0;
        const keluar = parseInt(row.cells[5].innerText.replace(/\./g, '')) || 0;
        if (nama === namaCari) {
          total += masuk - keluar;
        }
      });
      document.getElementById("hasilTotalPerNama").innerText = `Total saldo ${namaCari}: ${formatAngka(total)}`;
    }

    function saveData() {
      const data = Array.from(document.querySelectorAll("#tabelData tbody tr")).map(row =>
        Array.from(row.cells).slice(1, 6).map(cell => cell.innerText)
      );
      set(ref(db, "tabunganData"), data);
    }

    function loadData() {
      onValue(ref(db, "tabunganData"), (snapshot) => {
        const data = snapshot.val();
        if (data) {
          const tbody = document.querySelector("#tabelData tbody");
          tbody.innerHTML = "";
          data.forEach(rowData => {
            const row = tbody.insertRow();
            for (let i = 0; i < 6; i++) row.insertCell();
            tambahButtonHapus(row);
            rowData.forEach((val, idx) => row.cells[idx + 1].innerText = val);
          });
          updateTotalSaldo();
        }
      });
    }

    function resetDataFirebase() {
      remove(ref(db, "tabunganData")).then(() => {
        document.querySelector("#tabelData tbody").innerHTML = "";
        updateTotalSaldo();
        document.getElementById("hasilTotalPerNama").innerText = "";
      });
    }

    function resetData() {
      const passwordBenar = "1234";
      const inputPassword = prompt("Masukkan password untuk menghapus semua data:");
      if (inputPassword === null) return;
      if (inputPassword !== passwordBenar) {
        alert("Password salah!");
        return;
      }
      if (confirm("Yakin ingin menghapus semua data?")) {
        resetDataFirebase();
      }
    }

    window.onload = loadData;
  </script>
</body>
</html>
